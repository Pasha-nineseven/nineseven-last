<!DOCTYPE html>
<html lang="ru">
	<head>
		//= template/head.html
	</head>
	<body>
		<!--LAYOUT-->
		<div class="layout">
			//= template/header.html
			<main class="page-content workarea">
				<div class="container-fluid">
					<div class="page-title animated_el m-title">
						<div class="indent">
							<h1>
                                Разработка интернет-магазина<br>
                                и интеграций для Abamet-shop.ru
							</h1>
						</div>
					</div>
					<div class="p-case-top">
						<div class="indent">
							<div class="p-case-top__inner">
								<div class="p-case-top__icon animated_el m-bottom">
									<div class="p-case-top__logo">
										<img src="img/svg/abamet-logo.svg" alt="">
									</div>
									<a href="#" class="p-case-top__link" target="_blank">
										www.abamet-shop.ru
									</a>
								</div>
								<div class="p-case-top-info">
									<div class="p-case-top-info__item animated_el m-bottom">
										<div class="p-case-top-info__pre">
											Клиент
										</div>
										<div class="p-case-top-info__txt">
											Компания «Абамет» более 25 лет осуществляет поставки металлообрабатывающего оборудования. По сегодняшний день остается единственной компанией в своём сегменте, которая дает возможность заказать, оплатить онлайн и получить доставку. Весь жизненный цикл продажи автоматизирован.
										</div>
									</div>
									<div class="p-case-top-info__item animated_el m-bottom">
										<div class="p-case-top-info__pre">
											Задача
										</div>
										<div class="p-case-top-info__txt">
											Необходимо было обновить визуальный стиль проекта и упростить его структуру. Навигация была неудачной, клиенты просто терялись в каталоге, а поиск не всегда находил нужные позиции.
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

                    <div class="template__wrap animated_el m-bottom">
						<div class="indent">
							<div class="row optimization-more">
								<div class="col-lg-6 optimization-more__item">
									Мы переделали структуру каталога, обновили навигацию и совместно с клиентом обновили вложенность разделов. Сделали новый визуальный стиль и стилизацию остальных разделов под него. 
								</div>
								<div class="col-lg-6 optimization-more__item">
                                    На обновлении стиля дело не закончилось, поэтому данный кейс больше про автоматизацию процессов, а не новые шаблоны.
                                </div>
							</div>
						</div>
					</div>
                    <div class="template__wrap animated_el m-bottom">
						<div class="indent">
							<div class="row">
								<div class="col-lg-6 optimization-more__item">
									<h3>До:</h3>
                                    <div class="case-compare__img">
                                        <img src="img/content/abamet1.jpg" alt="">
                                    </div>
								</div>
								<div class="col-lg-6 optimization-more__item">
                                    <h3>После:</h3>
                                    <div class="case-compare__img">
                                        <img src="img/content/abamet2.jpg" alt="">
                                    </div>
                                </div>
							</div>
						</div>
					</div>

					<div class="p-architect">
						<div class="indent">
							<div class="row bl-top">
								<div class="col-lg-6 animated_el m-bottom">
									<h2>Планируем архитектуру проекта</h2>
								</div>
								<div class="col-lg-6 bl-top__txt animated_el m-bottom">
                                    <p>
                                        В 2019 решили уходить от старой системы SAP на новую связку ERP+CRM. В качестве систем интеграции были выбраны 1C как ERP, и Microsoft Dynamics как CRM. 
                                    </p>
                                    <p>
                                        За данную связку отвечал интегратор «Корус Консалтинг». Нашей задачей было внедрить в эти процессы интернет-магазин.
                                    </p>
								</div>
							</div>
                            <div class="b-filter-list m-architect animated_el m-bottom">
								<div class="b-filter-item">
									<div class="b-filter-in">
										1С
									</div>
                                    <div class="b-filter__more">
                                        Отдаёт номенклатуру, остатки, описание и фотографии товаров. Принимает остатки, заказы, статусы заказов.
                                    </div>
								</div>
								<div class="b-filter-item">
									<div class="b-filter-in">
										Интернет-магазин
									</div>
                                    <div class="b-filter__more">
                                        Принимает каталог, товары, уровни скидок. Отдаёт заказы, пользователей, статусы заказов, остатки по складам.
                                    </div>
								</div>
								<div class="b-filter-item">
									<div class="b-filter-in">
										Microsoft Dynamics
									</div>
                                    <div class="b-filter__more">
                                        Принимает информацию по клиентам: физики, юрики. Отдаёт уровни скидок, статистику по бонусам.
                                    </div>
								</div>
							</div>
						</div>
					</div>

                    <div class="t-template-item m-noPtop">
                        <div class="indent">
                            <div class="row t-template-item__wrap">
                                <div class="col-lg-6 animated_el m-bottom">
                                    <h3>Обмен по протоколу SOAP</h3>
                                </div> 
                                <div class="col-lg-6 animated_el m-bottom">
                                    <p>
                                        SOAP это старый и сложный протокол обмена который устоялся в 1С, поэтому часто для обменов с 1С используют именно его, а не более свободный по реализации REST.
                                    </p>
                                    <p>
                                        В общем виде обмен выглядит так:
                                    </p>
                                </div>
                                <div class="t-collect">
                                    <div class="p-architect-sqheme animated_el m-bottom">
                                        <a href="img/svg/ab-sqheme1.svg" class="mobile-target" target="_blank">
                                            <img src="img/svg/ab-sqheme1.svg" alt="">
                                        </a>
                                    </div>
                                </div>
                                <div class="col-lg-6 animated_el m-bottom">
                                    <p>
                                        В отличие от REST на SOAP формируется одна точка входа, а за маршрутизацию методов отвечает специальный WSDL-файл. Это xml-файл который описает методы и их структуру.
                                    </p>
                                </div> 
                                <div class="col-lg-6 animated_el m-bottom">
                                    <p>
                                        Реализации SOAP есть как на PHP так и у Битрикса. Но модуль битрикса давно не обновлялся, поэтому мы делали сборку на SOAP-PHP. 
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="p-architect">
						<div class="indent">
							<div class="row bl-top">
								<div class="col-lg-6 animated_el m-bottom">
									<h3>Планируем дорожную карту</h3>
								</div>
								<div class="col-lg-6 bl-top__txt animated_el m-bottom">
									<p>
										При построении сложных обменов главное правильно начать. Нужно строить обмен от базового. Логичнее всего в магазине было начать именно с каталога, и потом добавлять к нему всё остальное.
									</p>
								</div>
							</div>
                            <div class="p-architect__steps m-five">
                                <div class="p-architect__step animated_el m-bottom">
                                    <div class="p-architect__num m-red">01</div>
                                    <div class="p-architect__txt">
                                        Разработка SOAP-сервера для приёма категорий и товаров.
                                    </div>
                                </div>
                                <div class="p-architect__step animated_el m-bottom">
                                    <div class="p-architect__num m-red">02</div>
                                    <div class="p-architect__txt">
                                        Создание SOAP-клиента для передачи остатков из корзины
                                    </div>
                                </div>
                                <div class="p-architect__step animated_el m-bottom">
                                    <div class="p-architect__num m-red">03</div>
                                    <div class="p-architect__txt">
                                        Создание SOAP-клиента для передачи клиентов в CRM
                                    </div>
                                </div>
                                <div class="p-architect__step animated_el m-bottom">
                                    <div class="p-architect__num m-red">04</div>
                                    <div class="p-architect__txt">
                                        Создание SOAP-сервера для приёмки уровней скидок
                                    </div>
                                </div>
                                <div class="p-architect__step animated_el m-bottom">
                                    <div class="p-architect__num m-red">05</div>
                                    <div class="p-architect__txt">
                                        Создание SOAP-методов для отдачи информации о заказах
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6 animated_el m-bottom"></div>
								<div class="col-lg-6 bl-top__txt animated_el m-bottom">
									<p>
										Этапность строилась таким образом, что после каждого этапа происходила синхронизация баз данных, и пример когда мы делали реализацию передачи заказов, 1С уже понимала какие товары покупает клиент.
									</p>
								</div>
                            </div>
						</div>
					</div>

					<div class="t-template">
						<div class="indent">
							<div class="row t-template__top">
								<div class="col-lg-6 animated_el m-bottom">
									<h3>Защита и унификация обмена между тремя системами</h3>
									
								</div>
								<div class="col-lg-6 t-template__txt animated_el m-bottom">
									<p>
										Для реализации безопасного обмена используется два уровня:
									</p>
									
								</div>
							</div>
							<div class="row">
								<div class="col-lg-6 animated_el m-bottom">
									<p>
										Чтобы запрос прошёл, нужно чтобы вместе с передачей xml-пакета у системы был правильный basic auth заголовок. Если заголовок корректный, система проверяет валидность ключа обмена. Если ключ в пакете некорректный запрос отбраковывается.
									</p>
								</div>
								<div class="col-lg-6 animated_el m-bottom t-template-sqheme">
									<div class="t-template__img">
										<a href="img/svg/ab-sqheme2.svg" class="mobile-target" target="_blank">
                                            <img src="img/svg/ab-sqheme2.svg" alt="">
                                        </a>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="t-experience">
						<div class="indent">
							<div class="row">
								<div class="col-lg-6 animated_el m-bottom">
									<h3>Схема идентификации</h3>
								</div>
								<div class="col-lg-6 t-template__txt animated_el m-bottom">
									<p>
										В процессе задействованы три базы данных, а это значит что у каждой своя структура и логика хранения данных. Чтобы у систем была сквозная синхронизация и единые сущности индентифицировались одинаково, мы хранили все наборы идентификаторов.
									</p>
									<p>
										Каждая сущность обмена описывалась например так:
									</p>
								</div>
							</div>
							<div class="essence animated_el m-bottom">
								<div class="essence__item"><span>ID_ERP:</span>d1f5d2ce-4732-11e9-8dac-005056032acc</div>
								<div class="essence__item"><span>ID_CRM:</span>752df240-ff4a-e911-a83c-000d3ab2daff</div>
								<div class="essence__item"><span>ID_IM:</span>513-404-10e</div>
								<div class="essence__item"><span>ID_SAP:</span>513-404-10E</div>
							</div>
							<div class="row">
								<div class="col-lg-6 animated_el m-bottom"></div>
								<div class="col-lg-6 animated_el m-bottom">
									Это удобно, так как при обмене, например товаром, каждая система знает, какой объект к ней пришел.
								</div>
							</div>
						</div>
					</div>

					<div class="p-architect">
						<div class="indent">
							<div class="row bl-top">
								<div class="col-lg-6 animated_el m-bottom">
									<h3>Контуры обмена с 1С</h3>
								</div>
								<div class="col-lg-6 bl-top__txt animated_el m-bottom">
									<p>
										1С хранит информацию о каталоге, при этом не только о товарах, но о категориях, об уровнях вложенности, а так же SEO-описания для категорий. Кроме того, 1С отвечает и за бух. учет, поэтому информация о заказах поступает из ИМ напрямую в 1С.
									</p>
								</div>
							</div>
							<div class="row">
                                <div class="col-lg-6 animated_el m-bottom">
									<h4>
										Обмен с 1С проще всего показать на примере товара:
									</h4>
								</div>
								<div class="col-lg-6"></div>
                            </div>
                            <div class="t-collect animated_el m-bottom">
								<a href="img/svg/ab-sqheme3.svg" class="mobile-target" target="_blank">
									<img src="img/svg/ab-sqheme3.svg" alt="">
								</a>
							</div>
                           
						</div>
					</div>

					<div class="t-template">
						<div class="indent">
							<div class="row t-template__top">
								<div class="col-lg-12 animated_el m-bottom">
									<h3>Как описывать обмен для разработчика  и не облажаться?</h3>
								</div>
							</div>
							<div class="row t-template__top m-desktop">
								<div class="col-lg-12 animated_el m-bottom">
									ТЗ нужно разделить на три части (вырезки и рабочего ТЗ):
								</div>
							</div>
							<div class="row case-compare__wrap">
								<div class="col-lg-4 case-compare__item animated_el m-bottom">
									<div class="case-compare__title">
										<p>
											Описание порядка обмена по шагам, или в виде UML-диаграммы:
										</p>
									</div>
									<div class="case-compare__img">
										<img src="img/content/p-abam1.png" alt="">
									</div>
								</div>
								<div class="col-lg-4 case-compare__item animated_el m-bottom">
									<div class="case-compare__title">
										<p>
											Формат данных из пакета и соответствие записи в БД на стороне магазина:
										</p>
										
									</div>
									<div class="case-compare__img">
										<img src="img/content/p-abam2.png" alt="">
									</div>
								</div>
								<div class="col-lg-4 case-compare__item animated_el m-bottom">
									<div class="case-compare__title">
										<p>
											Пример запроса и ответа в формате обмена:
										</p>
										<br>
									</div>
									<div class="case-compare__img">
										<img src="img/content/p-abam3.png" alt="">
									</div>
								</div>
							</div>
						</div>
					</div>


					<div class="t-template-item-sm m-gr animated_el m-bottom">
						<div class="indent">
							<h4>Суммарно был реализованы следующие направления обмена</h4>
							<ul class="m-red m-column">
								<li>Структура каталога</li>
								<li>Товары</li>
								<li>SKU</li>
								<li>Цены</li>
								<li>Остатки</li>
								<li>Изображения и pdf</li>
								<li>Заказы</li>
								<li>Статусы заказов</li>
								<li>Характеристики товаров</li>
							</ul>
						</div>
					</div>

					<div class="p-architect">
						<div class="indent">
							<div class="row bl-top">
								<div class="col-lg-6 animated_el m-bottom">
									<h3>Контуры обмена с Microsoft Dynamics 365</h3>
								</div>
								<div class="col-lg-6 bl-top__txt animated_el m-bottom">
									<p>
										CRM в первую очередь работает с клиентам компании. В магазин и из магазина мы передаём информацию о клиентах, как о физ.лицах так и юр.лицах. Кроме того следим за объёмами их покупок, уровнями скидок.
									</p>
								</div>
							</div>
							<div class="t-collect animated_el m-bottom">
								<h4>
									Обмен с CRM происходит по следующей схеме:
								</h4><br>
								<a href="img/svg/ab-sqheme4.svg" class="mobile-target" target="_blank">
									<img src="img/svg/ab-sqheme4.svg" alt="">
								</a>
							</div>
							<div class="row">
                                <div class="col-lg-6 animated_el m-bottom">
									
									<p>
										Сложность при интеграции с CRM, в особенностях хранения сущеностей в двух системах. В Битрикс покупатель, это единая сущность, и 1 запись в базе данных. А тип покупателя, как физ.лицо или юр.лицо уже определяется на уровне заказа, как профиль покупателя.
									</p>
								</div>
								<div class="col-lg-6  animated_el m-bottom">
									<p>
										В CRM иерархия сложнее, так как есть сущность компания, в неё могут входить любое количество клиентов. Клиент не хотел ломать текущую схему хранения покупателей, поэтому мы написали скрипт который расширял хранимые данные по пользователям, и передавал их в единообразом виде в CRM, где уже система сама распределяла компании и клиентов как разные сущности.
									</p>
								</div>
                            </div>
						</div>
					</div>
					

					<div class="t-template">
						<div class="indent">
							<div class="row t-template__top">
								<div class="col-lg-6 animated_el m-bottom">
									<h3>Сервер очередей</h3>
									
								</div>
								<div class="col-lg-6 t-template__txt animated_el m-bottom">
									<p>
										Так как все три учетные системы ИМ, 1С и CRM находятся на разных серверах, и обмениваются инфомацией по сети, нужно было предусмотреть минимальный сервер очередей для огранизации отправки повторных сообщений при получении ошибок или сетевой недоступности.
									</p>
									<p>
										Готовые решения, вроде RabbitMQ слишком громозкие для нашей микрозадачи, поэтому мы написали свой скрипт и агента который работает с пакетами сообщений.
									</p>
								</div>
							</div>
							<div class="row">
								<div class="service-sqheme animated_el m-bottom">
									<div class="service-sqheme-top">
										<div class="service-sqheme-top__item">
											<div class="service-sqheme-top__in">Скрипт слушает все коды ошибок</div>
										</div>
										<div class="service-sqheme-top__item">
											<div class="service-sqheme-top__in">При возникновении ошибки событие логгируется вместе с методом и записывается в инфоблок с меткой времени</div>
										</div>
										<div class="service-sqheme-top__item">
											<div class="service-sqheme-top__in">Если метка времени в логе инфоблока по событию старше лимита в настройках, то пробуем отправить повторно</div>
										</div>
									</div>
									<div class="service-sqheme__img">
										<img src="img/content/abamet9.jpg" alt="">
									</div>
								</div>
							</div>
						</div>
					</div>



					
					<div class="p-roadmap log">
						<div class="indent">
							<div class="row">
								<div class="col-lg-6 animated_el m-bottom">
									<h3>Класс работы с логами</h3>
									<br>
									<h4>Как функции выполняет класс работы с логами</h4>
									<ul class="m-red">
										<li>Единая структура логгирования событий</li>
										<li>Единый формат</li>
										<li>Единая машрутизация логов</li>
										<li>Единые правила именования по суткам</li>
										<li>Сборка мусора (логи старше недели удаляются)</li>
									</ul>
								</div>
								<div class="col-lg-6 t-template__txt animated_el m-bottom">
									<p>
										Кроме реализации самого обмена, важным нюансом было выстроить корректную систему логгирования событий не только для сервера очередей, но и для каждого контура обмена в целом. Сложности с логгированием обычно в том, что неопытные проектировщики оставляют логгирование на откуп разработчику, поэтому можно получить несвязную кучу логов которое копятся годами.
									</p>
								</div>
							</div>
						</div>
					</div>

					<div class="team animated_el m-bottom">
						<div class="indent">
							<h3>Команда проекта</h3>
							<div class="team__wrap">
								<div class="team__item">
									<div class="team__line">
										<div class="team__top">Руководитель проекта</div>
										<div class="team__person">Дима Хоружко</div>
									</div>
								</div>
								<div class="team__item">
									<div class="team__line">
										<div class="team__top">PHP разработчики</div>
										<div class="team__person">Денис Иванов</div>
                                        <div class="team__person">Руслан Кадыров</div>
									</div>
								</div>
								<div class="team__item">
									<div class="team__line">
										<div class="team__top">Команда клиента</div>
										<div class="team__person">Дмитрий Сенькевич</div>
										<div class="team__person">Владимир Киселев</div>
									</div>
								</div>
								<div class="team__item">
									<div class="team__line">
										<div class="team__top">Архитектор обмена</div>
										<div class="team__person">Дима Хоружко</div>
									</div>
									
								</div>
                                <div class="team__item">
                                    <div class="team__line">
										<div class="team__top">Команда Webcom Media</div>
										<div class="team__person">Татьяна Снитич</div>
                                        <div class="team__person">Светлана Валяк</div>
									</div>
                                </div>
							</div>
						</div>	
					</div>
					<!--end CONTENT-PART -->
				</div>
			</main>
		</div><!-- END LAYOUT-->
		//= template/footer.html
			
		

		<script src="js/libs/libs.min.js"></script>
		<script src="js/interface.js"></script>
		<!-- <script src="js/pages.js"></script> -->
	</body>
</html>
